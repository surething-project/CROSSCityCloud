DECLARE obs_count INT64;

SET obs_count = (
  SELECT SUM(obs_total) as obs_total FROM (SELECT SUM(count) as obs_total FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-07-29` UNION ALL SELECT SUM(count) as obs_total FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-07-30` UNION ALL SELECT SUM(count) as obs_total FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-07-31` UNION ALL SELECT SUM(count) as obs_total FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-01` UNION ALL SELECT SUM(count) as obs_total FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-02` UNION ALL SELECT SUM(count) as obs_total FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-03` UNION ALL SELECT SUM(count) as obs_total FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-04` UNION ALL SELECT SUM(count) as obs_total FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-19`)
);

SELECT bssid, SUM(count) as freq, (SUM(count) / obs_count) as prob, obs_count FROM (SELECT bssid, count FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-07-29` UNION ALL SELECT bssid, count FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-07-30` UNION ALL SELECT bssid, count FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-07-31` UNION ALL SELECT bssid, count FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-01` UNION ALL SELECT bssid, count FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-02` UNION ALL SELECT bssid, count FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-03` UNION ALL SELECT bssid, count FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-04` UNION ALL SELECT bssid, count FROM `gsdsupport.cross_wifi_ap_obs.volatile_sb_2019-08-19`) GROUP BY bssid ORDER BY prob DESC
